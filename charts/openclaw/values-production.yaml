# Production values — full security, ingress with TLS, NFS persistence
# Use for production deployments with hardened security and ingress.
#
# IMPORTANT: This is an annotated example. Replace all <placeholder> values
# with your own configuration before deploying.

image:
  repository: ghcr.io/jedwards1230/openclaw-charts
  tag: latest
  pullPolicy: IfNotPresent

replicaCount: 1

strategy:
  type: Recreate

gateway:
  port: 18789
  bind: "lan"
  auth:
    mode: "token"
    allowTailscale: true
  controlUi:
    allowInsecureAuth: false

config: {}

hookTransforms: {}

agentScripts: {}

extraEnv: []

# Git identity for commits made by OpenClaw agents.
# Replace with your preferred bot name and email.
git:
  authorName: "OpenClaw"
  authorEmail: "openclaw@example.com"
  committerName: "OpenClaw"
  committerEmail: "openclaw@example.com"
  configGlobal: "/home/node/.openclaw/.gitconfig"

nodeOptions: "--max-old-space-size=1536"

homePath: "/home/node"

envsubst:
  image: dibi/envsubst:1

secrets:
  existingSecret: ""
  onepassword:
    enabled: false
    itemPath: ""

# NFS persistence for workspace/config.
# Set nfs.enabled: true and provide your NFS server IP and export path.
persistence:
  size: 10Gi
  accessModes:
    - ReadWriteMany
  nfs:
    enabled: true
    server: "<your-nfs-server>"      # e.g. "192.168.1.100"
    path: "<your-nfs-export-path>"   # e.g. "/exports/openclaw"

# Ingress with TLS.
# Replace host with your own domain. Configure annotations to match your
# ingress controller and any access-control middleware.
ingress:
  enabled: true
  host: "<your-domain>"              # e.g. "openclaw.example.com"
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    traefik.ingress.kubernetes.io/router.entrypoints: web,websecure
    # Add your ingress controller's access-restriction middleware here, e.g.:
    # traefik.ingress.kubernetes.io/router.middlewares: kube-system-redirect-lan@kubernetescrd
  tls:
    - hosts:
        - "<your-domain>"            # e.g. "openclaw.example.com"
      secretName: openclaw-tls

additionalIngresses: []

service:
  type: ClusterIP
  port: 18789

serviceAccount:
  create: true
  annotations: {}
  name: ""

# Production resource limits
resources:
  requests:
    cpu: 100m
    memory: 512Mi
  limits:
    cpu: 2000m
    memory: 2Gi

# Full security context
podSecurityContext:
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000
  runAsNonRoot: true
  seccompProfile:
    type: RuntimeDefault

securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  capabilities:
    drop:
      - ALL

# Optional: Velero backup hook annotations.
# Uncomment if you use Velero for cluster backups.
# podAnnotations:
#   backup.velero.io/backup-volumes: "openclaw-data"
#   pre.hook.backup.velero.io/container: "openclaw"
#   pre.hook.backup.velero.io/command: '["/bin/sh", "-c", "sync"]'
#   pre.hook.backup.velero.io/timeout: "30s"
podAnnotations: {}

# Optional: Set a priority class for scheduling priority.
# Avoid system-cluster-critical for non-system workloads.
priorityClassName: ""

probes:
  startup: {}
  liveness: {}
  readiness: {}

webhookd:
  enabled: false

tailscale:
  enabled: false

podLabels: {}

# Recommended: enable network policy in production to restrict egress
networkPolicy:
  enabled: true

extraVolumeMounts: []
extraVolumes: []

nodeSelector:
  kubernetes.io/arch: amd64
tolerations: []
# Pod anti-affinity: prefer spreading across nodes (useful if replicaCount > 1)
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                  - openclaw
          topologyKey: kubernetes.io/hostname
topologySpreadConstraints: []

# Playwright Chrome Headless Shell — avoids Chromium seccomp crashes in K8s
# chrome-headless-shell is purpose-built for container/CI environments and
# works under RuntimeDefault seccomp without any seccomp relaxation.
playwright:
  enabled: true
  browsersPath: "/home/node/.cache/ms-playwright"
  cache:
    enabled: true
    size: 1Gi
    storageClassName: ""
