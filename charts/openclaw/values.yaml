image:
  repository: ghcr.io/jedwards1230/openclaw-charts
  tag: latest
  pullPolicy: IfNotPresent

imagePullSecrets: []

replicaCount: 1

strategy:
  type: Recreate

# -- OpenClaw gateway configuration (templated into openclaw.json)
gateway:
  port: 18789
  bind: "lan"
  auth:
    mode: "token"
    # -- Allow Tailscale identity-header authentication (tailscale whois)
    allowTailscale: false
  controlUi:
    # -- Allow non-HTTPS auth for control UI. Set to true only for local development without TLS.
    allowInsecureAuth: false

# -- Freeform app config (merged with gateway into openclaw.json)
# Add any top-level openclaw.json keys here (agents, channels, tools, etc.)
# These are serialized to JSON as-is — no chart update needed for config changes.
config: {}

# -- Extra environment variables for the main container
# Use this to inject secrets, API keys, or any additional env vars.
# Example:
#   extraEnv:
#     - name: MY_SECRET
#       valueFrom:
#         secretKeyRef:
#           name: my-secret
#           key: MY_KEY
extraEnv: []

# -- Git identity for commits
git:
  authorName: "LilClaw"
  authorEmail: "lilclaw@lilbro.cloud"
  committerName: "LilClaw"
  committerEmail: "lilclaw@lilbro.cloud"
  configGlobal: "/home/node/.openclaw/.gitconfig"

# -- Node.js options
nodeOptions: "--max-old-space-size=1536"

# -- Home directory path inside the container
homePath: "/home/node"

# -- Envsubst init container image (runs as non-root, must include envsubst binary)
# Pin to a versioned tag or digest — avoid :latest for supply-chain safety.
envsubst:
  image: dibi/envsubst:1

# -- Secrets configuration
secrets:
  existingSecret: ""
  onepassword:
    enabled: false
    itemPath: ""

# -- NFS persistence for openclaw workspace/config
persistence:
  size: 10Gi
  accessModes:
    - ReadWriteMany
  nfs:
    enabled: false
    server: ""
    path: ""

# -- Ingress configuration
ingress:
  enabled: false
  host: ""
  annotations: {}
  tls: []

# -- Additional ingresses for separate access rules
# Useful for exposing specific endpoints (e.g., webhooks) with different
# security settings while keeping the main UI restricted to LAN-only access.
#
# Example: Expose /hooks endpoint publicly while main UI stays LAN-only
# additionalIngresses:
#   - name: webhook
#     enabled: true
#     host: openclaw.example.com
#     path: /hooks
#     pathType: Prefix
#     annotations:
#       traefik.ingress.kubernetes.io/router.entrypoints: web,websecure
#       cert-manager.io/cluster-issuer: letsencrypt-prod
#     tls:
#       - hosts:
#           - openclaw.example.com
#         secretName: openclaw-webhook-tls
additionalIngresses: []

# -- Service configuration
service:
  type: ClusterIP
  port: 18789

# -- ServiceAccount configuration
serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

# -- Resource requests and limits
resources:
  requests:
    cpu: 100m
    memory: 512Mi
  limits:
    cpu: 2000m
    memory: 2Gi

# -- Pod security context
podSecurityContext:
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000
  runAsNonRoot: true
  seccompProfile:
    type: RuntimeDefault

# -- Container security context
securityContext:
  allowPrivilegeEscalation: false
  # Writable paths (/tmp, ~/.cache, ~/.npm) are provided via emptyDir mounts.
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  capabilities:
    drop:
      - ALL

# -- Pod annotations (e.g., Velero backup hooks)
podAnnotations: {}

# -- Priority class name for scheduling priority
priorityClassName: ""

# -- Override default health probes (TCP socket on gateway port)
# Set per-probe config to override. Omit or set to {} to use defaults.
probes:
  startup: {}
  liveness: {}
  readiness: {}

# -- Webhookd sidecar: GitHub webhook signature verification proxy
# Receives GitHub webhook POSTs, verifies X-Hub-Signature-256 HMAC,
# and forwards to openclaw's /hooks/agent endpoint using the x-openclaw-token header.
webhookd:
  enabled: false
  image:
    repository: node
    tag: "22-alpine"
    pullPolicy: IfNotPresent
  port: 8090
  # -- Target path on openclaw gateway to forward verified webhooks to
  targetPath: "/hooks/agent"
  resources:
    requests:
      cpu: 10m
      memory: 32Mi
    limits:
      cpu: 100m
      memory: 64Mi

# -- Tailscale sidecar: expose the gateway on your tailnet
# When enabled, a Tailscale sidecar container runs alongside OpenClaw,
# providing a tailnet hostname via `tailscale serve`. The OpenClaw container
# stays on LAN binding so Traefik ingress continues working.
tailscale:
  enabled: false
  # -- Existing secret containing the Tailscale auth key
  authKeySecret: ""
  # -- Key within the secret that holds the auth key value
  authKeySecretKey: "TS_AUTHKEY"
  # -- Hostname on the tailnet (e.g., "openclaw")
  hostname: ""
  # -- Tailscale image
  image:
    repository: ghcr.io/tailscale/tailscale
    tag: "v1.82.5"
    pullPolicy: IfNotPresent
  # -- Sidecar resource limits
  resources:
    requests:
      cpu: 10m
      memory: 32Mi
    limits:
      cpu: 100m
      memory: 128Mi

# -- Additional pod labels
# Note: Pod Security Admission (PSA) labels (pod-security.kubernetes.io/*)
# must be applied to the Namespace, not individual Pods. Configure them on
# the namespace outside this chart if needed.
podLabels: {}

# -- Network policy configuration
# When enabled, applies a NetworkPolicy that:
# - Allows inbound traffic from Traefik ingress and from any pod in the same namespace
# - Allows outbound traffic to DNS (UDP/53), HTTP (TCP/80), HTTPS (TCP/443), and in-namespace mcp-proxy (TCP/8080)
networkPolicy:
  enabled: false

nodeSelector:
  kubernetes.io/arch: amd64
tolerations: []
affinity: {}
